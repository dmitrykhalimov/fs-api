(()=>{"use strict";const e={state:"NO_CHANGES",class:"result__label--not-changed",message:"Изменений нет"},t={state:"CHANGED_FILE",class:"result__label--changed",message:"Изменены файлы:"},a={state:"CHANGED_STRUCTRE",class:"result__label--structure",message:"Произошли изменения в структуре файлов"};let n=0;const s=document.querySelector(".root-folder"),r=(e,t)=>{e.appendChild(t)},c=(t,a)=>{let n="";if(t.state===e.state){const e=a.querySelector(".result__label--not-changed:last-of-type");e&&e.remove()}n=(e=>{const t=(new Date).toLocaleString(),a=document.createElement("p");return a.classList.add("result__label"),a.classList.add(e.class),a.textContent=`${t} ${e.message}`,a})(t),r(a,n)},l=e=>{const t=e.querySelector("ul");t&&t.remove()},o=document.querySelector(".open-folder"),i=document.querySelector(".show-updated"),d=document.querySelector(".enable-watch"),u=document.querySelector(".tree"),w=document.querySelector(".result__container");let y="",f="",m="",p="",_=[];const h=async e=>{const t=[];for await(const[a,n]of e.entries()){let e="";"file"===n.kind&&(e=await n.getFile()),t.push({key:a,value:n,updated:e.lastModified})}return t},v=async(e,t=[],a=[])=>{for(let a of e)if("file"===a.value.kind)a.updated>f&&t.push(a);else{const e=await h(a.value);await v(e,t)}return t},g=async(e,t=[])=>{for await(const[a,n]of e.entries())t.push(a),"directory"===n.kind&&await g(n,t);return JSON.stringify(t)},C=async(e,t)=>{const a=document.createElement("li");if("directory"===t.kind){a.classList.add("directory"),a.innerHTML=(n++,`<input type="checkbox" id="${s=e}-${n}"> \n  <label for="${s}-${n}">${s}</label>`);const r=await h(t);a.appendChild(await k(r))}else a.classList.add("file"),a.textContent=e;var s;return a},k=async e=>{const t=document.createElement("ul");e.sort((e=>"file"===e.value.kind?1:-1));for(let a of e){const{key:e,value:n}=a,s=await C(e,n);t.appendChild(s)}return t},S=async()=>{const e=await h(y),t=await k(e);var a;a=y.name,s.textContent=a,r(u,t)},E=async()=>{m&&(await(async()=>{const e=await g(y);return _!==e&&(l(u),S(),_=e,c(a,w),!0)})()||(await(async()=>{const a=await h(y),n=await v(a);0!==n.length?(c(t,w),r(w,await k(n))):c(e,w)})(),f=(new Date).getTime()))};o.addEventListener("click",(async()=>{m=!1,l(u),w.innerHTML="",p&&(clearTimeout(p),d.textContent="Включить отслеживание",p=""),y=await window.showDirectoryPicker(),S(),_=await g(y),m=!0,f=(new Date).getTime()})),i.addEventListener("click",E),d.addEventListener("click",(()=>{if(m){if(!p)return d.textContent="Выключить отслеживание",void(p=setInterval(E,1e3));d.textContent="Включить отслеживание",clearTimeout(p)}}))})();